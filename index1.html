<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="responsive.css">

    <title>Exercise</title>
</head>
<body>
    <section class = "search-section">
        <div class = "container">
            <div >
                <h1 class="header">Giphy API Example</h1>
                <div class="recent-searches" id = "recent-searches">
                    <div class="recent-searches" id = "recent-searches-default">
                    </div>
                    <div class="recent-searches" id = "recent-searches-added">
                    </div>
                </div>
                <div class = "search">
                    <input type = "text" class="search-text" id = "text">
                    <div class='search-buttons'>
                        <input type = "button" value="Submit" class="search-button-submit" id = "submit">
                        <input type = "button" value="See what's trending" class="search-button-ternding" id = "trending">
                    </div>
                    
                </div> 
            </div>
        </div>
    </section>
    <section class = "gallery-section">
        <div class = "container">
            <div class = "gallery" id="gallery">

            </div>
        </div>
    </section>
    <div class="recent-search-item-close">
    </div>
</body>
   
<script>

    const urlDefault  = 'https://api.giphy.com/v1/gifs/search?limit=10&api_key=aFFKTuSMjd6j0wwjpFCPXZipQbcnw3vB&fmt=json&q=';
    const urlTrending = 'https://api.giphy.com/v1/gifs/trending?limit=10&api_key=aFFKTuSMjd6j0wwjpFCPXZipQbcnw3vB&fmt=json';
    // const queryStringParameters = {
    //     limit: 10,
    //     api_key: 'aFFKTuSMjd6j0wwjpFCPXZipQbcnw3vB',
    //     fmt: 'json'
    // };

    class getData{
    onSubmit = () => {
        const index = document.getElementById("text").value;
        //move to separate function
        let searchList = JSON.parse(localStorage.getItem('searchList'));
            console.log(searchList.added);
            if(!searchList.added.includes(index)){
                searchList.added.unshift(index);
                this._addSearchItem(index,'recent-searches-added');
                localStorage.setItem('searchList', JSON.stringify(searchList));
            }
        this._getData(index,urlDefault).then(a => this._getList(a.data));
    }
    onTrending = () => {
        this._getData('',urlTrending).then(a => this._getList(a.data));
    }
    _getData = async (index,src) =>{
            const url = src+index;
            const a = await fetch(url);
            let b = await a.json();
            return b;
        }
    _getList = (data) => {
        document.getElementById('gallery').innerHTML='';
        for(let a in data){
            this._draw(data[a].images.original.url,data[a].rating);
        }
    }
    _draw = (src,rating) =>{
        const div = document.createElement('div');
        div.className = "gallery-item";
        const img = document.createElement('img');
        img.src = src;
        div.append(img);
        const divRating = document.createElement('div');
        divRating.className='gallery-item-rating';
        divRating.innerHTML = `Rating: ${rating}`;
        div.append(divRating);
        document.getElementById('gallery').append(div);
    }
    _addSearchItem = (value,id) =>{
        const inputContainer = document.createElement('div');
        inputContainer.className = 'recent-search-item-container';
        const input = document.createElement('input');
        input.className = "recent-search-item";
        input.type = 'button';
        input.id = value;
        input.value = value;
        const closeLogo = document.createElement('div');
        closeLogo.className = 'recent-search-item-close';
        inputContainer.append(closeLogo);
        inputContainer.append(input);
        document.getElementById(id).prepend(inputContainer);
        closeLogo.addEventListener('click',()=>{close(closeLogo);});
        input.addEventListener('click',()=>{this._getData(input.value,urlDefault).then(a => this._getList(a.data));})
    }
    }
    function close(node){
        node.parentNode.parentNode.removeChild(node.parentNode);
        const inputVal = node.nextSibling;
        let searchList = JSON.parse(localStorage.getItem('searchList'));
        searchList.added.splice(searchList.added.indexOf(searchList.id),1);
        localStorage.setItem('searchList', JSON.stringify(searchList));
    }
    let dato = new getData();
    let searchList = JSON.parse(localStorage.getItem('searchList'));
    if(searchList==null){
        searchList = {added:[],default:[]};
    }
    searchList.default = ["Internet Cats", "Meme's", "Typing", "Space", "Rick and Morty"];
    localStorage.setItem('searchList', JSON.stringify(searchList));
    for(let a in searchList){
        for(let b in searchList[a]){
            dato._addSearchItem(searchList[a][b],'recent-searches-default');
        }
    }
    document.getElementById("submit").addEventListener('click',()=>{dato.onSubmit();});
    document.getElementById("trending").addEventListener('click',()=>{dato.onTrending();});
    

</script>
</html>